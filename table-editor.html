<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>table</title>
</head>

<style>
    .tables-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-content: center;
        gap: 20px;
    }

    .table-holder {
        border: 2px solid black;
        padding: 5px;
    }

    #tokenstat {
        color: red;
    }
</style>

<body>
    <button id="generateTokenLink">Clicker pour commencez</button>
    <h1 id="tokenstat">Not ready</h1>
    <div class="tables-container">
        <div class="table-holder table-holder-1">
            <h3>2 Baccalauréat (Groupe 1)</h3>
            <table>
                <tr>
                    <th></th>
                    <th>19:00-20:30</th>
                    <th>20:30-22:00</th>
                </tr>
                <tr>
                    <td>Lundi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mardi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mercredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Jeudi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Vendredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Samedi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
            </table>
        </div>
        <div class="table-holder table-holder-2">
            <h3>2 Baccalauréat (Groupe 2)</h3>
            <table>
                <tr>
                    <th></th>
                    <th>19:00-20:30</th>
                    <th>20:30-22:00</th>
                </tr>
                <tr>
                    <td>Lundi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mardi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mercredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Jeudi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Vendredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Samedi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
            </table>
        </div>
        <div class="table-holder table-holder-3">
            <h3>1 Baccalauréat</h3>
            <table>
                <tr>
                    <th></th>
                    <th>19:00-20:30</th>
                    <th>20:30-22:00</th>
                </tr>
                <tr>
                    <td>Lundi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mardi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mercredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Jeudi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Vendredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Samedi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
            </table>
        </div>
        <div class="table-holder table-holder-4">
            <h3>Tronc Commun</h3>
            <table>
                <tr>
                    <th></th>
                    <th>19:00-20:30</th>
                    <th>20:30-22:00</th>
                </tr>
                <tr>
                    <td>Lundi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mardi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mercredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Jeudi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Vendredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Samedi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
            </table>
        </div>
        <div class="table-holder table-holder-5">
            <h3>3 ème A.C (Groupe 1)</h3>
            <table>
                <tr>
                    <th></th>
                    <th>19:00-20:30</th>
                    <th>20:30-22:00</th>
                </tr>
                <tr>
                    <td>Lundi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mardi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mercredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Jeudi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Vendredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Samedi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
            </table>
        </div>
        <div class="table-holder table-holder-6">
            <h3>3 ème A.C (Groupe 2)</h3>
            <table>
                <tr>
                    <th></th>
                    <th>19:00-20:30</th>
                    <th>20:30-22:00</th>
                </tr>
                <tr>
                    <td>Lundi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mardi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mercredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Jeudi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Vendredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Samedi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
            </table>
        </div>
        <div class="table-holder table-holder-7">
            <h3>2 ème A.C</h3>
            <table>
                <tr>
                    <th></th>
                    <th>19:00-20:30</th>
                    <th>20:30-22:00</th>
                </tr>
                <tr>
                    <td>Lundi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mardi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mercredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Jeudi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Vendredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Samedi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
            </table>
        </div>
        <div class="table-holder table-holder-8">
            <h3>1 ème A.C</h3>
            <table>
                <tr>
                    <th></th>
                    <th>19:00-20:30</th>
                    <th>20:30-22:00</th>
                </tr>
                <tr>
                    <td>Lundi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mardi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Mercredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Jeudi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Vendredi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
                <tr>
                    <td>Samedi</td>
                    <td><input type="text" name="" id=""></td>
                    <td><input type="text" name="" id=""></td>
                </tr>
            </table>
        </div>
    </div>
</body>

<script>
    function closeTab() {
        const currentURL = window.location.href;

        console.log(currentURL);

        if (currentURL != "https://centre-lexellence.github.io/table/table-editor.html") {
            window.close();
        }
    }

    window.addEventListener('load', closeTab);

    const clientId = 'kigjitoui3np9di';
    const redirectUri = 'https://centre-lexellence.github.io/table/table-editor.html';
    let newWindow;
    let accessToken;

    let sharedLink;

    document.getElementById('generateTokenLink').addEventListener('click', () => {
        const authUrl = `https://www.dropbox.com/oauth2/authorize?client_id=${clientId}&response_type=token&redirect_uri=${redirectUri}`;
        newWindow = window.open(authUrl, '_blank');
        if (!newWindow) {
            alert('Please allow pop-ups to proceed.');
        }
    });

    let callCount = 0;
    const maxCallCount = 10;
    let animationFrameId;

    function captureURL() {
        if (newWindow) {
            const newWindowURL = newWindow.location.href;
            console.log('URL of the new window:', newWindowURL);

            callCount++;

            if (callCount >= maxCallCount) {
                const url = new URL(newWindowURL);
                console.log(url);
                const hash = url.hash;
                accessToken = hash.split('=')[1].split('&')[0];
                console.log(accessToken);

                newWindow.close();

                cancelAnimationFrame(animationFrameId);

                document.getElementById("tokenstat").innerHTML = "All good, now edit!";
                document.getElementById("tokenstat").style.color = "green";

            } else {
                animationFrameId = requestAnimationFrame(captureURL);
            }
        }
    };

    document.getElementById('generateTokenLink').addEventListener('click', () => {
        animationFrameId = requestAnimationFrame(captureURL);
    });

    console.log(accessToken)
</script>

</html>